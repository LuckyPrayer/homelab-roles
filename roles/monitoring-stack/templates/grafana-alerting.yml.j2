# Grafana Alerting Configuration
# Generated by Ansible - Do not edit manually
# Configures contact points and notification policies for Grafana alerts

apiVersion: 1

contactPoints:
  - orgId: 1
    name: discord-bot
    receivers:
      - uid: discord-webhook
        type: webhook
        settings:
{% if alertmanager_discord_webhook %}
          url: "{{ alertmanager_discord_webhook | replace('/webhook/alert', '/webhook/grafana') }}"
{% else %}
          url: "http://hephaestus-{{ env }}:8085/webhook/grafana"
{% endif %}
          httpMethod: POST
          maxAlerts: 10
        disableResolveMessage: false

  - orgId: 1
    name: alertmanager
    receivers:
      - uid: alertmanager-receiver
        type: prometheus-alertmanager
        settings:
          url: http://alertmanager:9093
        disableResolveMessage: false

policies:
  - orgId: 1
    receiver: discord-bot
    group_by:
      - grafana_folder
      - alertname
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      # Critical alerts - faster notification
      - receiver: discord-bot
        object_matchers:
          - ["severity", "=", "critical"]
        group_wait: 10s
        repeat_interval: 1h
        continue: false
      
      # Also send to Alertmanager for redundancy
      - receiver: alertmanager
        continue: true

templates: []

muteTimeIntervals: []
