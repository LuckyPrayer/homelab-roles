# Backrest - Web UI for restic backup management
# https://github.com/garethgeorge/backrest
# Generated by Ansible - Do not edit manually

services:
  backrest:
    image: {{ backrest_image }}
    container_name: {{ backrest_container_name }}
    hostname: {{ inventory_hostname }}
    restart: unless-stopped
    ports:
      - "{{ backrest_port }}:9898"
    environment:
      - BACKREST_DATA={{ backrest_data_path }}
      - BACKREST_CONFIG={{ backrest_config_path }}
      - XDG_CACHE_HOME={{ backrest_cache_path }}
      - TMPDIR={{ backrest_tmp_path }}
      - TZ={{ backrest_timezone }}
    volumes:
      - {{ backrest_base_dir }}/data:{{ backrest_data_path }}
      - {{ backrest_base_dir }}/config:{{ backrest_config_path | dirname }}
      - {{ backrest_base_dir }}/cache:{{ backrest_cache_path }}
      - {{ backrest_base_dir }}/tmp:{{ backrest_tmp_path }}
      - {{ backrest_backups_dir }}:/backups
    networks:
      - {{ backrest_network }}
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:9898"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  {{ backrest_network }}:
    external: true
